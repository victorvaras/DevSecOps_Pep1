<?xml version="1.0" encoding="UTF-8"?>
<ruleset name="React Security Best Practices"
         xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd">

    <description>Reglas para ReactJS usando PMD + ECMAScript</description>

    <!-- ================================= -->
    <!-- 1. Reglas de Seguridad            -->
    <!-- ================================= -->
    <rule name="AvoidDangerouslySetInnerHTML"
          language="ecmascript"
          class="net.sourceforge.pmd.lang.rule.xpath.XPathRule"
          message="[SEC-01] Uso de dangerouslySetInnerHTML sin sanitización">
        <priority>1</priority>
        <properties>
            <property name="xpath">
                <value><![CDATA[
                    //JSXAttribute[@Name='dangerouslySetInnerHTML']
                    [not(ancestor::CallExpression/Callee/@Image='sanitizeHTML')]
                ]]></value>
            </property>
        </properties>
    </rule>

    <!-- ================================= -->
    <!-- 2. Mejores Prácticas              -->
    <!-- ================================= -->
    <rule name="HookUsageOrder"
          language="ecmascript"
          class="net.sourceforge.pmd.lang.rule.xpath.XPathRule"
          message="[BP-01] Los Hooks deben ser usados en orden consistente">
        <priority>2</priority>
        <properties>
            <property name="xpath">
                <value><![CDATA[
                    //CallExpression[matches(@Image,'^use[A-Z]')]
                    [not(ancestor::FunctionDeclaration)]
                ]]></value>
            </property>
        </properties>
    </rule>

    <!-- ================================= -->
    <!-- 3. Reglas de Estructura           -->
    <!-- ================================= -->
    <rule name="ComponentFileStructure"
          language="ecmascript"
          class="net.sourceforge.pmd.lang.rule.xpath.XPathRule"
          message="[STR-01] Archivo debe contener solo un componente principal">
        <priority>3</priority>
        <properties>
            <property name="xpath">
                <value><![CDATA[
                    count(//FunctionDeclaration[matches(@Image,'^[A-Z]')]) > 1
                ]]></value>
            </property>
        </properties>
    </rule>

</ruleset>