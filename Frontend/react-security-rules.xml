<?xml version="1.0"?>
<ruleset name="React Best Practices Ruleset"
         xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd">

    <description>Reglas para mejores prácticas y seguridad en ReactJS</description>

    <!-- Reglas PMD nativas para HTML/JS -->
    <rule ref="category/html/bestpractices.xml/AvoidInlineStyles" />  <!-- [1] -->
    <rule ref="category/html/bestpractices.xml/UnnecessaryTypeAttribute" />  <!-- [1] -->
    <rule ref="category/javascript/bestpractices.xml/UnusedLocalVariable" />

    <!-- Reglas personalizadas para React -->
    <rule name="AvoidDangerouslySetInnerHTML"
          language="jsx"
          message="Evitar uso de dangerouslySetInnerHTML sin sanitización [2][4]">
        <priority>1</priority>
        <properties>
            <property name="xpath">
                <value><![CDATA[
                    //JSXAttribute[@Name='dangerouslySetInnerHTML']
                    [not(ancestor::CallExpression/Callee/Name='sanitizeHTML')]
                ]]></value>
            </property>
        </properties>
        <example><![CDATA[
            // Mal
            <div dangerouslySetInnerHTML={{__html: userContent}} />
            
            // Bueno
            <div dangerouslySetInnerHTML={{__html: sanitizeHTML(userContent)}} />
        ]]></example>
    </rule>

    <rule name="HookUsageOrder"
          language="js"
          message="Los Hooks deben ser usados en orden consistente [4]">
        <priority>2</priority>
        <properties>
            <property name="xpath">
                <value><![CDATA[
                    //CallExpression[matches(@Image,'^use[A-Z]')]
                    [not(ancestor::FunctionDeclaration)]
                ]]></value>
            </property>
        </properties>
    </rule>

    <rule name="PropTypesValidation"
          language="js"
          message="Componente sin validación de PropTypes [2]">
        <priority>3</priority>
        <properties>
            <property name="xpath">
                <value><![CDATA[
                    //FunctionDeclaration[matches(@Image,'^[A-Z]')]
                    [not(//MemberExpression[@PropertyName='propTypes'])]
                ]]></value>
            </property>
        </properties>
    </rule>

    <!-- Reglas de estructura de código -->
    <rule name="ComponentSize"
          language="js"
          message="Componente excede 200 líneas - considerar descomposición [2]">
        <priority>3</priority>
        <properties>
            <property name="minimum">
                <value>200</value>
            </property>
        </properties>
    </rule>

    <rule name="InlineEventHandler"
          language="jsx"
          message="Evitar manejadores de eventos inline en JSX [4]">
        <priority>2</priority>
        <properties>
            <property name="xpath">
                <value><![CDATA[
                    //JSXAttribute[matches(@Name,'^on[A-Z]')]
                    [ArrowFunctionExpression or FunctionExpression]
                ]]></value>
            </property>
        </properties>
    </rule>

</ruleset>
